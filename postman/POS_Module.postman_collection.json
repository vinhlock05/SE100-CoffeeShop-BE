{
  "info": {
    "name": "SE100 CoffeeShop - POS Module (Complete)",
    "description": "Bộ sưu tập đầy đủ các API cho module POS, Kitchen và Combo.",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    { "key": "baseUrl", "value": "http://localhost:3000/api" },
    { "key": "accessToken", "value": "" },
    { "key": "orderId", "value": "" },
    { "key": "comboId", "value": "1" },
    { "key": "itemId", "value": "" },
    { "key": "tableId", "value": "1" }
  ],
  "item": [
    {
      "name": "0. Auth",
      "item": [
        {
          "name": "Login",
          "event": [{ "listen": "test", "script": { "exec": [
            "var jsonData = pm.response.json();",
            "if (jsonData.metaData && jsonData.metaData.accessToken) {",
            "  pm.collectionVariables.set('accessToken', jsonData.metaData.accessToken);",
            "}"
          ]}}],
          "request": {
            "method": "POST",
            "url": "{{baseUrl}}/auth/login",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": { "mode": "raw", "raw": "{\n  \"username\": \"admin\",\n  \"password\": \"123456\"\n}" }
          }
        }
      ]
    },
    {
      "name": "1. Order Management",
      "description": "CRUD và lifecycle của Order",
      "item": [
        {
          "name": "Get Orders List",
          "description": "Lấy danh sách đơn hàng (filter theo status, table, date...)",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/orders?page=1&limit=10&status=pending",
              "host": ["{{baseUrl}}"],
              "path": ["orders"],
              "query": [
                { "key": "page", "value": "1" },
                { "key": "limit", "value": "10" },
                { "key": "status", "value": "pending", "description": "pending | in_progress | completed | cancelled" },
                { "key": "tableId", "value": "1", "disabled": true },
                { "key": "fromDate", "value": "2024-01-01", "disabled": true },
                { "key": "toDate", "value": "2024-12-31", "disabled": true }
              ]
            },
            "header": [{ "key": "Authorization", "value": "Bearer {{accessToken}}" }]
          }
        },
        {
          "name": "Get Order Detail",
          "description": "Xem chi tiết một đơn hàng",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/orders/{{orderId}}",
            "header": [{ "key": "Authorization", "value": "Bearer {{accessToken}}" }]
          }
        },
        {
          "name": "Create Order - Single Items",
          "description": "Tạo đơn với món lẻ (không combo). Backend tự lấy name và price từ DB.",
          "event": [{ "listen": "test", "script": { "exec": [
            "var jsonData = pm.response.json();",
            "if (jsonData.metaData && jsonData.metaData.id) {",
            "  pm.collectionVariables.set('orderId', jsonData.metaData.id);",
            "  var items = jsonData.metaData.orderItems;",
            "  if (items && items.length > 0) pm.collectionVariables.set('itemId', items[0].id);",
            "}"
          ]}}],
          "request": {
            "method": "POST",
            "url": "{{baseUrl}}/orders",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{accessToken}}" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"tableId\": 1,\n  \"items\": [\n    { \"itemId\": 1, \"quantity\": 2, \"notes\": \"Ít đá\" },\n    { \"itemId\": 2, \"quantity\": 1 }\n  ],\n  \"notes\": \"Bàn VIP\"\n}"
            }
          }
        },
        {
          "name": "Create Order - With Combo",
          "description": "Tạo đơn với Combo. FE gửi từng món trong combo với comboId. Backend tính giá pro-rate.",
          "event": [{ "listen": "test", "script": { "exec": [
            "var jsonData = pm.response.json();",
            "if (jsonData.metaData && jsonData.metaData.id) {",
            "  pm.collectionVariables.set('orderId', jsonData.metaData.id);",
            "}"
          ]}}],
          "request": {
            "method": "POST",
            "url": "{{baseUrl}}/orders",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{accessToken}}" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"tableId\": 1,\n  \"items\": [\n    { \"itemId\": 1, \"comboId\": 1, \"quantity\": 1 },\n    { \"itemId\": 2, \"comboId\": 1, \"quantity\": 1 }\n  ],\n  \"notes\": \"Order Combo\"\n}"
            }
          }
        },
        {
          "name": "Create Order - Takeaway",
          "description": "Tạo đơn mang đi (không cần tableId)",
          "request": {
            "method": "POST",
            "url": "{{baseUrl}}/orders",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{accessToken}}" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"orderType\": \"takeaway\",\n  \"items\": [\n    { \"itemId\": 1, \"quantity\": 1 }\n  ],\n  \"notes\": \"Khách mang đi\"\n}"
            }
          }
        },
        {
          "name": "Add Item - Single",
          "description": "Thêm món lẻ vào order đang mở",
          "request": {
            "method": "POST",
            "url": "{{baseUrl}}/orders/{{orderId}}/items",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{accessToken}}" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"itemId\": 3,\n  \"quantity\": 1,\n  \"notes\": \"Ít đường\"\n}"
            }
          }
        },
        {
          "name": "Add Item - With Topping",
          "description": "Thêm món kèm topping (trà sữa + trân châu)",
          "event": [{ "listen": "test", "script": { "exec": [
            "var jsonData = pm.response.json();",
            "if (jsonData.metaData && jsonData.metaData.orderItems) {",
            "  var lastItem = jsonData.metaData.orderItems.filter(i => !i.isTopping).pop();",
            "  if (lastItem) pm.collectionVariables.set('itemId', lastItem.id);",
            "}"
          ]}}],
          "request": {
            "method": "POST",
            "url": "{{baseUrl}}/orders/{{orderId}}/items",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{accessToken}}" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"itemId\": 5,\n  \"quantity\": 1,\n  \"notes\": \"50% đường\",\n  \"attachedToppings\": [\n    { \"itemId\": 10, \"quantity\": 1 },\n    { \"itemId\": 11, \"quantity\": 2 }\n  ]\n}"
            }
          }
        },
        {
          "name": "Add Item - Combo",
          "description": "Thêm 1 món thuộc Combo vào order. FE gửi itemId + comboId.",
          "request": {
            "method": "POST",
            "url": "{{baseUrl}}/orders/{{orderId}}/items",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{accessToken}}" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"itemId\": 1,\n  \"comboId\": 1,\n  \"quantity\": 1\n}"
            }
          }
        },
        {
          "name": "Update Order Item",
          "description": "Sửa món (số lượng, ghi chú, toppings)",
          "request": {
            "method": "PATCH",
            "url": "{{baseUrl}}/orders/{{orderId}}/items/{{itemId}}",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{accessToken}}" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"quantity\": 2,\n  \"notes\": \"Đổi ít đá\"\n}"
            }
          }
        },
        {
          "name": "Remove Order Item",
          "description": "Xóa món khỏi order (tự động xóa toppings kèm theo)",
          "request": {
            "method": "DELETE",
            "url": "{{baseUrl}}/orders/{{orderId}}/items/{{itemId}}",
            "header": [{ "key": "Authorization", "value": "Bearer {{accessToken}}" }]
          }
        },
        {
          "name": "Send to Kitchen",
          "description": "Gửi order xuống bếp. Items PENDING -> PREPARING, Order -> IN_PROGRESS",
          "request": {
            "method": "POST",
            "url": "{{baseUrl}}/orders/{{orderId}}/send-to-kitchen",
            "header": [{ "key": "Authorization", "value": "Bearer {{accessToken}}" }]
          }
        },
        {
          "name": "Checkout (Payment)",
          "description": "Thanh toán đơn hàng",
          "request": {
            "method": "POST",
            "url": "{{baseUrl}}/orders/{{orderId}}/checkout",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{accessToken}}" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"paymentMethod\": \"cash\",\n  \"paidAmount\": 200000\n}"
            }
          }
        },
        {
          "name": "Cancel Order",
          "description": "Hủy đơn hàng",
          "request": {
            "method": "PATCH",
            "url": "{{baseUrl}}/orders/{{orderId}}",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{accessToken}}" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"status\": \"cancelled\"\n}"
            }
          }
        }
      ]
    },
    {
      "name": "2. Kitchen Flow",
      "description": "API cho màn hình Bếp/Pha chế",
      "item": [
        {
          "name": "Get Kitchen Items",
          "description": "Lấy danh sách món cần làm",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/orders/kitchen/items?status=preparing",
              "host": ["{{baseUrl}}"],
              "path": ["orders", "kitchen", "items"],
              "query": [
                { "key": "status", "value": "preparing", "description": "pending | preparing" }
              ]
            },
            "header": [{ "key": "Authorization", "value": "Bearer {{accessToken}}" }]
          }
        },
        {
          "name": "Get Item Recipe",
          "description": "Xem công thức/hướng dẫn làm món",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/orders/kitchen/items/{{itemId}}/recipe",
            "header": [{ "key": "Authorization", "value": "Bearer {{accessToken}}" }]
          }
        },
        {
          "name": "Update Item Status (Done 1)",
          "description": "Báo xong 1 món (nút > trên FE). all=false",
          "request": {
            "method": "PATCH",
            "url": "{{baseUrl}}/orders/items/{{itemId}}/status",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{accessToken}}" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"status\": \"completed\",\n  \"all\": false\n}"
            }
          }
        },
        {
          "name": "Update Item Status (Done All)",
          "description": "Báo xong HẾT món (nút >> trên FE). all=true",
          "request": {
            "method": "PATCH",
            "url": "{{baseUrl}}/orders/items/{{itemId}}/status",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{accessToken}}" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"status\": \"completed\",\n  \"all\": true\n}"
            }
          }
        },
        {
          "name": "Mark Item Served",
          "description": "Báo đã phục vụ khách (Waiter dùng)",
          "request": {
            "method": "PATCH",
            "url": "{{baseUrl}}/orders/items/{{itemId}}/status",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{accessToken}}" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"status\": \"served\",\n  \"all\": true\n}"
            }
          }
        },
        {
          "name": "Report Out of Stock",
          "description": "Báo hết nguyên liệu",
          "request": {
            "method": "POST",
            "url": "{{baseUrl}}/orders/kitchen/items/{{itemId}}/out-of-stock",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{accessToken}}" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"ingredients\": [\"Trân châu đen\"]\n}"
            }
          }
        }
      ]
    },
    {
      "name": "3. Table Operations",
      "description": "Thao tác quản lý bàn",
      "item": [
        {
          "name": "Get Tables List",
          "description": "Lấy danh sách bàn và trạng thái",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/tables",
            "header": [{ "key": "Authorization", "value": "Bearer {{accessToken}}" }]
          }
        },
        {
          "name": "Transfer Table",
          "description": "Chuyển order sang bàn khác",
          "request": {
            "method": "POST",
            "url": "{{baseUrl}}/orders/{{orderId}}/transfer",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{accessToken}}" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"newTableId\": 5\n}"
            }
          }
        },
        {
          "name": "Merge Orders",
          "description": "Gộp 2 bàn thành 1 (gộp order A vào order B)",
          "request": {
            "method": "POST",
            "url": "{{baseUrl}}/orders/{{orderId}}/merge",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{accessToken}}" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"fromOrderId\": 2\n}"
            }
          }
        },
        {
          "name": "Split Order",
          "description": "Tách một số món sang bàn mới",
          "request": {
            "method": "POST",
            "url": "{{baseUrl}}/orders/{{orderId}}/split",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{accessToken}}" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"newTableId\": 3,\n  \"items\": [\n    { \"itemId\": 1, \"quantity\": 1 }\n  ]\n}"
            }
          }
        }
      ]
    },
    {
      "name": "4. Combo Module",
      "description": "CRUD Combo (Admin)",
      "item": [
        {
          "name": "Get Active Combos (POS)",
          "description": "Lấy combo đang active để hiển thị trên POS",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/combos/active",
            "header": [{ "key": "Authorization", "value": "Bearer {{accessToken}}" }]
          }
        },
        {
          "name": "Get All Combos (Admin)",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/combos?page=1&limit=10",
              "host": ["{{baseUrl}}"],
              "path": ["combos"],
              "query": [
                { "key": "page", "value": "1" },
                { "key": "limit", "value": "10" },
                { "key": "isActive", "value": "true", "disabled": true }
              ]
            },
            "header": [{ "key": "Authorization", "value": "Bearer {{accessToken}}" }]
          }
        },
        {
          "name": "Get Combo Detail",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/combos/{{comboId}}",
            "header": [{ "key": "Authorization", "value": "Bearer {{accessToken}}" }]
          }
        },
        {
          "name": "Create Combo",
          "event": [{ "listen": "test", "script": { "exec": [
            "var jsonData = pm.response.json();",
            "if (jsonData.metaData && jsonData.metaData.id) {",
            "  pm.collectionVariables.set('comboId', jsonData.metaData.id);",
            "}"
          ]}}],
          "request": {
            "method": "POST",
            "url": "{{baseUrl}}/combos",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{accessToken}}" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Combo Trà + Bánh\",\n  \"description\": \"1 Trà + 1 Bánh - Tiết kiệm 10k\",\n  \"imageUrl\": \"https://example.com/combo.jpg\",\n  \"comboPrice\": 65000,\n  \"originalPrice\": 75000,\n  \"startDate\": \"2024-01-01\",\n  \"endDate\": \"2024-12-31\",\n  \"items\": [\n    { \"itemId\": 5, \"quantity\": 1, \"groupName\": \"Chọn 1 ly trà\", \"isRequired\": true },\n    { \"itemId\": 6, \"quantity\": 1, \"groupName\": \"Chọn 1 ly trà\", \"isRequired\": true },\n    { \"itemId\": 10, \"quantity\": 1, \"groupName\": \"Chọn 1 món bánh\", \"isRequired\": true },\n    { \"itemId\": 11, \"quantity\": 1, \"groupName\": \"Chọn 1 món bánh\", \"isRequired\": true }\n  ]\n}"
            }
          }
        },
        {
          "name": "Update Combo",
          "request": {
            "method": "PATCH",
            "url": "{{baseUrl}}/combos/{{comboId}}",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{accessToken}}" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Combo Trà + Bánh (Updated)\",\n  \"comboPrice\": 60000\n}"
            }
          }
        },
        {
          "name": "Toggle Combo Active",
          "request": {
            "method": "PATCH",
            "url": "{{baseUrl}}/combos/{{comboId}}/toggle-active",
            "header": [{ "key": "Authorization", "value": "Bearer {{accessToken}}" }]
          }
        },
        {
          "name": "Delete Combo",
          "request": {
            "method": "DELETE",
            "url": "{{baseUrl}}/combos/{{comboId}}",
            "header": [{ "key": "Authorization", "value": "Bearer {{accessToken}}" }]
          }
        }
      ]
    }
  ]
}
